<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=Shift_JIS" http-equiv="content-type">
    <title>LR2beta3 スキンcsv仕様書 応用編</title>
    <meta name="author" content=".RED">
    <meta name="GENERATOR" content="MSHTML 8.00.6001.23520">
    <meta name="ROBOTS" content="NOINDEX,NOFOLLOW">
    <style type="text/css">
        body {
            font-size: 12px;
        }
        
        div {
            margin-left: 10px;
            padding-bottom: 30px;
        }
        
        p {
            margin-left: 20px;
        }
        
        h4 {
            margin-top: 4em;
            width: 96%;
            width: calc(100% - 14px);
            background: -moz-linear-gradient(white, #E0E0E0);
            background: -webkit-gradient(linear, left top, left bottom, from(white), to(#E0E0E0));
            background: -ms-linear-gradient(top, white, #E0E0E0);
            -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='#cFFF', endColorstr='#E0E0E0', GradientType=0)";
            padding: 6px;
            border: solid 1px #999;
            border-radius: 3px;
        }
        
        h4:before {
            width: 5px;
            display: inline-block;
            background: #666;
            content: "　";
            margin-right: 5px;
            padding: 2px;
        }
    </style>
</head>

<body>
    <h2>不具合関連</h2>
    <div id="content">
        <a id="if_op330" name="if_op330">
            <h4>op330番台のIF分岐</h4>
        </a>
        <p> op330 スコアが更新された から始まるリザルト用のオプションですが、
            <br> これらのオプションはプレイ・リザルトスキンに#FLIPRESULT命令が含まれているとIF分岐では正常に動作しません。
            <br> ただしDSTオプションスロット（op1〜op3）では何故か動きます。
            <br> 優秀なスキン屋さんであれば「DISABLEFLIP使えばいいじゃん」と思うかもしれませんが
            <br> 残念ながらこの不具合はDISABLEFLIP命令を使っても回避出来ません。
            <br>
            <br> 厳密には「ミスカウント0の場合のみ正常に動作可能」だったり、いくつかのオプションは問題無く動いたりと色々特性があるんですが使用する場合は一応注意。
        </p>
        <a id="number_align2" name="number_align2">
            <h4>NUMBER定義のalign2（中央寄せ）特有の注意点</h4>
        </a>
        <p> DST_NUMBERのw値が奇数の場合、裏0無しのalign=2で奇数桁（1桁や3桁）を表示すると画像がバグります。
            <br> 10分割NUMBER定義で中央寄せを使う場合は注意。
        </p>
        <p>左がSRC画像、右がバグ画像
            <br>
            <img alt="num_align_bug" src="num_align_bug.gif"></p>
        <a id="op3" name="op3">
            <h4>op3の注意点</h4>
        </a>
        <p> 主に選曲スキンで使用されるop3 カーソルがコース に関する注意点です。
            <br> このオプション、通常は問題ありませんがIRランキング閲覧中には強制的にオフになります。
        </p>
        <p>また、コースモードはランキング閲覧中のみ内部的に曲扱いになるらしく、op2も自動的にオンになります。
            <br> op290 コースモード は正常に動作するため、コースモードのop指定には290（あるいは!290）を使いましょう。
            <br>
            <br> 曲とコースでキッチリ分岐させるにはop2 AND op-290 と op290 で分岐させる必要があります。</p>
        <a id="assist" name="assist">
            <h4>リザルトスキンにおけるAUTO SCRATCHオプション分岐</h4>
        </a>
        <p> <s>「option142 AUTO SCRATCH (自動皿抜きでクリアすれば消えます) 」はリザルト演出後、選曲画面に戻らないとONになりません。<br>
          このためRBリザではop55 AUTOSCRATCH 1P ON とop90 クリア のAND条件で代用しています。</s>
            <br> ※改めて確認したら普通に動いてました。「場合によっては動かないかも？」くらいの認識で。
            <br> ちなみに自動皿抜きでクリアしても消えないのは結構有名なお話。
            <br> この定義部分を作った時期を考えると前述のFLIPRESULT命令が絡んでいる可能性も少なくないですが試してません。
        </p>
        <a id="courseskin" name="courseskin">
            <h4>コースリザルトスキンの切り替え</h4>
        </a>
        <p> スキン製作とは直接関係ありませんが、LR2の設定ファイルには最後に使用したコースリザルトスキンを保存する箇所が存在しません。
            <br> このため、LR2上で切り替えたコースリザルトスキンはLR2を再起動すると元に戻ってしまうことがあります。
            <br> 正確には「パスが一番若いコースリザのlr2skinファイル」が優先的に選択されるため、
            <br> デフォスキンにhtコースリザを追加した場合は問題無く動きますが、RBコースリザだとデフォスキンに戻ります。
            <br>
            <br> パスが若ければ良いだけなのでlr2skinファイルの配置だけ変更すれば解決出来ますが、readmeに一筆書く位の優しさが必要です。
            <br> （基本的にlr2skinファイルからの相対参照は張られないため、lr2skinファイル自体はLR2filesフォルダ以下であれば何処に置いてもスキンは正常に動作します）
            <br>
        </p>
        <a id="hidsud" name="hidsud">
            <h4>HIDDENとSUDDEN</h4>
        </a>
        <p> 現状のDX+では正常に動作していませんがこれはプレイスキンcsvの構成に関係しています。
            <br> LR2でのHIDDEN・SUDDENオプションはノーツ定義の前に記述されている定義の数によって、
            <br> ノーツの出現・消滅位置が変動するという不具合がLR2サポート掲示板で報告されています。
            <br> （さくっと試した感じではcsv全体の定義総数も影響してるようでした）
            <br>
            <br> つまり、DX+では実際にはオプションは有効になっているがエフェクト位置が画面外になってしまい、
            <br> HIDDENではノーツが表示されずSUDDENは効果が無いように見える、という状態。
            <br> 割と誤解されがちですが.REDがHIDDEN・SUDDENを実装していないという事ではありません。
            <br> （そもそもこれらの機能はスキン側ではなく本体側で制御されているため、意図的に排除する事は不可能です）
            <br>
            <br> ただ、DX+だとよりによって.REDが最も重視しているフレーム組み立てとタイトルエフェクトをごっそり吹っ飛ばさないと駄目なので永遠に未対応です。
            <br>
            <br> ノーツ関連記述の前の定義数が少なすぎても出現・消滅位置が下に下がってしまうため、
            <br> レーンの真ん中に合わせるにはかなりシビアな定義個数の調整が要求されます。
            <br> この定義個数は#から始まるスキン定義の合計っぽいのでDSTだけ水増ししていけば多分正解に辿り着きます。
            <br> ※定義総数が絡んでるせいでDX+では何やっても効果が無かったので細かい部分までチェックしてません。
        </p>
        <a id="random" name="hidsud">
            <h4>RANDOMオプションとバトル</h4>
        </a>
        <p> 割と有名な不具合ですがLR2ではバトル時に左右で別々の譜面オプション（RANDOMやMIRRORなど）を使うと
            <br> 左右のトータルノーツが一致しなくなります。 （厳密にはトータルノーツからどちらかのラスト数ノーツが減り、その分が反対側に加算されます）
        </p>
        <p>リザルトでも同様の表記になるため、内部的なトータルノーツが狂う形になりますがフルコンタイマーは何故か元のトータルノーツで動作するため、
            <br> 不具合発生時にはどちらかのフルコンエフェクトは曲が終わる前に動作し、反対側のフルコンエフェクトは動作しなくなります。
            <br> 譜面によっては2P側が減ったり、稀に正常に動いたりしますが詳細は不明です。
            <br> オートプレイでも発生するので動作確認時は特に注意しましょう。
        </p>
        <a id="fullcombo_failed" name="fullcombo_failed">
            <h4>フルコン落ち時のクリア判定の分岐特性</h4>
        </a>
        <p> LR2ではフルコン時にゲージをごっそり減らしてクリア失敗すると「フルコン落ち」というバグが発生します。
            <br> 以前twitterの方ではP-ATTACKについて言及しましたが、LR2BBSの不具合報告を漁ってみると
            <br> ノマゲでも同様のクリア判定になっているらしいので、おそらく同種のバグと考えて良いでしょう。
            <br>
            <br> このバグ自体はスキン側では回避不能ですが、この時のオプションの分岐が定義によって異なります。
            <br> IF定義でop90 クリア op91 クリア失敗 の分岐を組むとクリア扱い（op90がON）になりますが、
            <br> オプションスロットでop90/91分岐させるとクリア失敗扱い（op91がON）になります。
            <br>
            <br> ※なお、これとは別枠でクリアマークは本体側の仕様として
        </p>
        <ul>
            <li> 曲単体プレイ時にフルコン落ちした場合はフルコンクリアランプが点灯</li>
            <li>コースプレイ時にフルコン落ちした場合はFAILEDランプが点灯</li>
        </ul>
        <p> となります。</p>
        <a id="battle_lift" name="battle_lift">
            <h4>バトル用LIFT</h4>
        </a>
        <p> 1Pと2PのDST_LINEでそれぞれ別な座標を使った場合、2P側の小節線の表示開始が遅れます。（レーンの途中から表示されます）
            <br> 1P側のDST_LINE値と表示開始座標は反比例関係にあるようです。
        </p>
    </div>
</body>

</html>